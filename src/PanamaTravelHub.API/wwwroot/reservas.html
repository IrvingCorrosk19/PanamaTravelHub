<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mis Reservas ‚Äî ToursPanama</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/css/design-system.css" />
  <link rel="stylesheet" href="/css/loading.css" />
  <link rel="stylesheet" href="/css/enhancements.css" />
  <style>
    /* =========================
       TOURISM PREMIUM DESIGN SYSTEM
       Modern, Clean, Trustworthy
       ========================= */

    :root{
      /* === Premium Tourism Theme === */
      /* Clean, professional tourism palette */
      --bg-primary: #fafbfc;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #f1f5f9;
      --bg-surface: #ffffff;
      --bg-elevated: #ffffff;
      
      /* Card backgrounds with subtle depth */
      --card-primary: #ffffff;
      --card-secondary: #ffffff;
      --card-hover: #ffffff;
      
      /* Professional borders */
      --border-subtle: #e2e8f0;
      --border-default: #cbd5e1;
      --border-strong: #94a3b8;
      
      /* Tourism-focused typography */
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --text-tertiary: #64748b;
      --text-muted: #94a3b8;
      
      /* Tourism brand colors */
      --accent-primary: #0ea5e9;
      --accent-secondary: #06b6d4;
      --accent-success: #10b981;
      --accent-warning: #f59e0b;
      --accent-error: #ef4444;
      
      /* Tourism gradients */
      --gradient-primary: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
      --gradient-accent: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
      --gradient-subtle: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      
      /* Soft shadows for depth */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
      
      /* Modern border radius */
      --radius-xs: 4px;
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 16px;
      --radius-2xl: 20px;
      --radius-3xl: 24px;
      --radius-full: 9999px;
      
      /* Generous spacing for tourism */
      --space-1: 4px;
      --space-2: 8px;
      --space-3: 12px;
      --space-4: 16px;
      --space-5: 20px;
      --space-6: 24px;
      --space-8: 32px;
      --space-10: 40px;
      --space-12: 48px;
      --space-16: 64px;
      --space-20: 80px;
      --space-24: 96px;
      --space-32: 128px;
      
      /* Modern typography */
      --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      --font-mono: 'SF Mono', Monaco, Inconsolata, 'Roboto Mono', monospace;
      
      /* Container */
      --container-max: 1200px;
    }

    *{
      box-sizing: border-box;
    }

    body{
      margin: 0;
      font-family: var(--font-sans);
      font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      color: var(--text-primary);
      background: var(--bg-primary);
      background-image: 
        radial-gradient(ellipse at top left, rgba(14, 165, 233, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse at bottom right, rgba(6, 182, 212, 0.04) 0%, transparent 50%),
        radial-gradient(ellipse at center, rgba(16, 185, 129, 0.02) 0%, transparent 50%);
      background-attachment: fixed;
      line-height: 1.6;
      font-size: 16px;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* Clean Navigation */
    .nav{
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: saturate(180%) blur(20px);
      background: rgba(255, 255, 255, 0.95);
      border-bottom: 1px solid var(--border-subtle);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .nav-inner{
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--space-5) 0;
      gap: var(--space-6);
      max-width: var(--container-max);
      margin: 0 auto;
      padding: 0 var(--space-6);
    }
    .brand{
      display: flex;
      align-items: center;
      gap: var(--space-3);
    }
    .mark{
      width: 48px;
      height: 48px;
      border-radius: var(--radius-xl);
      background: var(--gradient-primary);
      box-shadow: var(--shadow-md);
      border: 1px solid rgba(14, 165, 233, 0.2);
      position: relative;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .mark:hover{
      transform: scale(1.05);
      box-shadow: var(--shadow-lg);
    }
    .brand-text{
      font-size: 20px;
      line-height: 1.2;
      font-weight: 700;
      letter-spacing: -0.02em;
      color: var(--text-primary);
      text-decoration: none;
    }
    .nav-links{
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }
    .nav-link{
      font-size: 14px;
      color: var(--text-secondary);
      padding: var(--space-3) var(--space-4);
      border-radius: var(--radius-lg);
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 500;
      text-decoration: none;
    }
    .nav-link:hover{
      background: var(--bg-secondary);
      color: var(--text-primary);
      transform: translateY(-1px);
    }
    .nav-link.active{
      background: var(--gradient-primary);
      color: white;
    }
    .nav-user-greeting{
      font-size: 14px;
      color: var(--text-secondary);
      padding: var(--space-3) var(--space-4);
      border-radius: var(--radius-lg);
      background: var(--bg-secondary);
      border: 1px solid var(--border-default);
    }

    /* Tourism Button Styles */
    .btn-primary{
      border: none;
      background: var(--gradient-primary);
      color: white;
      font-weight: 600;
      padding: var(--space-4) var(--space-8);
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      text-decoration: none;
      font-size: 15px;
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }
    .btn-primary::before{
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .btn-primary:hover::before{
      left: 100%;
    }
    .btn-primary:hover{
      filter: brightness(1.05);
      box-shadow: var(--shadow-xl);
      transform: translateY(-2px);
    }
    .btn-primary:disabled{
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      filter: none;
    }

    /* =========================
       PREMIUM TOURISM RESERVATIONS
       Modern, Clear, Trustworthy
       ========================= */
    .reservations-container {
      max-width: var(--container-max);
      margin: 0 auto;
      padding: var(--space-32) var(--space-6);
    }

    .section-header {
      margin-bottom: var(--space-32);
      text-align: center;
    }

    .section-header h1 {
      font-size: clamp(2rem, 4vw, 3rem);
      font-weight: 900;
      background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 50%, #6366f1 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0 0 16px 0;
      letter-spacing: -0.03em;
      line-height: 1.1;
      position: relative;
      display: inline-block;
    }
    
    .section-header h1::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      height: 4px;
      background: linear-gradient(90deg, #0ea5e9, #6366f1);
      border-radius: 2px;
      animation: slideInLeft 0.6s ease-out;
    }
    
    @keyframes slideInLeft {
      from {
        width: 0;
        opacity: 0;
      }
      to {
        width: 80px;
        opacity: 1;
      }
    }

    .section-subtitle {
      color: var(--text-secondary);
      font-size: clamp(1rem, 2vw, 1.125rem);
      margin: 24px auto 0;
      font-weight: 500;
      line-height: 1.6;
      max-width: 600px;
    }

    /* Premium Loading State */
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-32);
      min-height: 400px;
      background: var(--card-primary);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-3xl);
      box-shadow: var(--shadow-lg);
    }

    /* Premium Empty State */
    .empty-state-container {
      text-align: center;
      padding: var(--space-32);
      background: var(--card-primary);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-3xl);
      box-shadow: var(--shadow-lg);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      max-width: 600px;
      margin: 0 auto;
    }
    .empty-state-container:hover{
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
      border-color: var(--border-strong);
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: var(--space-6);
      opacity: 0.8;
    }

    .empty-state-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: var(--space-4);
      letter-spacing: -0.01em;
    }

    .empty-state-message {
      color: var(--text-secondary);
      margin-bottom: var(--space-8);
      font-size: 16px;
      line-height: 1.6;
    }

    /* Premium Error State */
    .error-state {
      text-align: center;
      padding: var(--space-32);
      background: var(--card-primary);
      border: 2px solid var(--accent-error);
      border-radius: var(--radius-3xl);
      box-shadow: var(--shadow-lg), 0 0 30px rgba(239, 68, 68, 0.1);
      max-width: 600px;
      margin: 0 auto;
    }

    .error-state-icon {
      font-size: 4rem;
      margin-bottom: var(--space-6);
      color: var(--accent-error);
    }

    /* Premium Reservations Grid */
    .reservations-list {
      display: grid;
      gap: var(--space-8);
      max-width: var(--container-max);
      margin: 0 auto;
    }

    /* =========================
       PREMIUM TOURISM CARD DESIGN
       Clear, Scannable, Trustworthy
       ========================= */
    .reservation-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.95) 100%);
      border: 2px solid rgba(226, 232, 240, 0.8);
      border-radius: 24px;
      padding: 0;
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.08),
        0 4px 16px rgba(0, 0, 0, 0.04),
        0 0 0 1px rgba(255, 255, 255, 0.5) inset;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      backdrop-filter: blur(20px);
      cursor: pointer;
    }
    
    /* Borde superior animado con gradiente */
    .reservation-card::before{
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, #0ea5e9, #06b6d4, #6366f1);
      opacity: 0;
      transition: opacity 0.4s ease;
      z-index: 1;
    }
    
    /* Efecto de brillo sutil en hover */
    .reservation-card::after{
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(14, 165, 233, 0.1) 0%, transparent 70%);
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.4s ease;
      pointer-events: none;
    }
    
    .reservation-card:hover {
      box-shadow: 
        0 16px 48px rgba(0, 0, 0, 0.12),
        0 8px 24px rgba(0, 0, 0, 0.08),
        0 0 0 1px rgba(14, 165, 233, 0.2) inset;
      border-color: rgba(14, 165, 233, 0.4);
      transform: translateY(-8px) scale(1.01);
      background: linear-gradient(135deg, rgba(255, 255, 255, 1) 0%, rgba(248, 250, 252, 0.98) 100%);
    }
    
    .reservation-card:hover::before{
      opacity: 1;
    }
    
    .reservation-card:hover::after{
      opacity: 1;
    }

    /* Card Header - Tour Name & Status */
    .reservation-header {
      padding: 28px 32px 24px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
      border-bottom: 2px solid rgba(226, 232, 240, 0.6);
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.02) 0%, rgba(99, 102, 241, 0.01) 100%);
      position: relative;
    }

    .reservation-title-section {
      flex: 1;
      min-width: 0;
      position: relative;
      z-index: 2;
    }

    .reservation-title {
      font-size: clamp(1.25rem, 2.5vw, 1.75rem);
      font-weight: 800;
      color: var(--text-primary);
      margin: 0 0 12px 0;
      letter-spacing: -0.02em;
      line-height: 1.2;
      background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      transition: all 0.3s ease;
    }
    
    .reservation-card:hover .reservation-title {
      transform: translateX(4px);
    }

    .reservation-id {
      font-size: 12px;
      color: var(--text-muted);
      font-family: var(--font-mono);
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.08), rgba(99, 102, 241, 0.05));
      padding: 6px 12px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(14, 165, 233, 0.2);
      margin-top: 8px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .reservation-card:hover .reservation-id {
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.12), rgba(99, 102, 241, 0.08));
      border-color: rgba(14, 165, 233, 0.3);
      transform: translateX(2px);
    }

    /* Status Badge - Prominent but Clean */
    .reservation-status-badge {
      padding: 10px 20px;
      border-radius: 50px;
      font-size: 12px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      white-space: nowrap;
      box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.15),
        0 2px 4px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 2;
    }
    
    /* Efecto shine en hover */
    .reservation-status-badge::before{
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.6s ease;
    }
    
    .reservation-status-badge:hover::before{
      left: 100%;
    }
    
    .reservation-status-badge:hover {
      transform: scale(1.05);
      box-shadow: 
        0 6px 16px rgba(0, 0, 0, 0.2),
        0 3px 8px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }

    /* Status Colors - Tourism Focused - Premium */
    .status-pending {
      background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);
      color: white;
      border-color: rgba(245, 158, 11, 0.4);
      animation: pulse-urgency 2s ease-in-out infinite;
    }
    
    @keyframes pulse-urgency {
      0%, 100% {
        box-shadow: 
          0 4px 12px rgba(245, 158, 11, 0.4),
          0 2px 4px rgba(0, 0, 0, 0.1),
          inset 0 1px 0 rgba(255, 255, 255, 0.3);
      }
      50% {
        box-shadow: 
          0 6px 16px rgba(245, 158, 11, 0.5),
          0 3px 8px rgba(0, 0, 0, 0.15),
          inset 0 1px 0 rgba(255, 255, 255, 0.4);
      }
    }

    .status-confirmed {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border-color: rgba(16, 185, 129, 0.4);
    }

    .status-completed {
      background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
      color: white;
      border-color: rgba(14, 165, 233, 0.4);
    }

    .status-cancelled {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border-color: rgba(239, 68, 68, 0.4);
    }

    .status-expired {
      background: linear-gradient(135deg, #64748b 0%, #475569 100%);
      color: white;
      border-color: rgba(100, 116, 139, 0.4);
    }

    /* Card Body - Key Information */
    .reservation-body {
      padding: 24px 32px;
      flex: 1;
      position: relative;
      z-index: 2;
    }

    .reservation-details-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      margin-bottom: 0;
    }

    .detail-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 16px;
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.03), rgba(99, 102, 241, 0.02));
      border-radius: 12px;
      border: 1px solid rgba(226, 232, 240, 0.6);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .detail-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #0ea5e9, #6366f1);
      transform: scaleX(0);
      transition: transform 0.3s ease;
      transform-origin: left;
    }
    
    .detail-item:hover::before {
      transform: scaleX(1);
    }
    
    .detail-item:hover {
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.06), rgba(99, 102, 241, 0.04));
      border-color: rgba(14, 165, 233, 0.3);
      transform: translateY(-2px);
      box-shadow: 
        0 4px 12px rgba(14, 165, 233, 0.1),
        0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .detail-label {
      font-size: 11px;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .detail-value {
      font-size: 18px;
      font-weight: 800;
      color: var(--text-primary);
      letter-spacing: -0.02em;
      line-height: 1.2;
    }
    
    /* Destacar el precio */
    .detail-item:has(.detail-label:contains("Total")) .detail-value {
      background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 20px;
    }

    /* Card Footer - Actions */
    .reservation-actions {
      padding: 20px 32px 28px;
      border-top: 2px solid rgba(226, 232, 240, 0.6);
      background: linear-gradient(135deg, rgba(248, 250, 252, 0.5), rgba(255, 255, 255, 0.8));
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
      position: relative;
      z-index: 2;
    }

    .btn-action {
      padding: var(--space-4) var(--space-6);
      border: none;
      border-radius: var(--radius-lg);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      position: relative;
      overflow: hidden;
      text-decoration: none;
    }
    .btn-action::before{
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.5s;
    }
    .btn-action:hover::before{
      left: 100%;
    }

    /* Primary Action - Most Important */
    .btn-action-primary {
      background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 50%, #6366f1 100%);
      color: white;
      box-shadow: 
        0 4px 12px rgba(14, 165, 233, 0.3),
        0 2px 4px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
      flex: 1;
      justify-content: center;
      min-width: 160px;
      font-weight: 700;
      position: relative;
      overflow: hidden;
    }
    
    .btn-action-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s ease;
    }
    
    .btn-action-primary:hover::before {
      left: 100%;
    }

    .btn-action-primary:hover:not(:disabled) {
      background: linear-gradient(135deg, #0284c7 0%, #0891b2 50%, #4f46e5 100%);
      box-shadow: 
        0 6px 20px rgba(14, 165, 233, 0.4),
        0 3px 8px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      transform: translateY(-3px) scale(1.02);
    }

    /* Secondary Action - Less Important */
    .btn-action-secondary {
      background: white;
      color: var(--text-primary);
      border: 2px solid rgba(226, 232, 240, 0.8);
      flex: 1;
      justify-content: center;
      min-width: 160px;
      font-weight: 600;
      box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.05),
        0 1px 2px rgba(0, 0, 0, 0.03);
      position: relative;
      overflow: hidden;
    }
    
    .btn-action-secondary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(14, 165, 233, 0.08), transparent);
      transition: left 0.5s ease;
    }
    
    .btn-action-secondary:hover::before {
      left: 100%;
    }

    .btn-action-secondary:hover:not(:disabled) {
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.05), rgba(99, 102, 241, 0.03));
      border-color: rgba(14, 165, 233, 0.4);
      color: #0ea5e9;
      transform: translateY(-3px);
      box-shadow: 
        0 4px 12px rgba(14, 165, 233, 0.15),
        0 2px 6px rgba(0, 0, 0, 0.08);
    }

    .btn-action:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Invoice Link - Tertiary Action */
    .invoice-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.08), rgba(99, 102, 241, 0.05));
      color: #0ea5e9;
      border: 2px solid rgba(14, 165, 233, 0.3);
      border-radius: 12px;
      text-decoration: none;
      font-weight: 700;
      font-size: 13px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 2px 8px rgba(14, 165, 233, 0.1),
        0 1px 2px rgba(0, 0, 0, 0.05);
      position: relative;
      overflow: hidden;
    }
    
    .invoice-link::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s ease;
    }
    
    .invoice-link:hover::before {
      left: 100%;
    }

    .invoice-link:hover {
      background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
      color: white;
      border-color: rgba(14, 165, 233, 0.5);
      transform: translateY(-3px) scale(1.05);
      box-shadow: 
        0 6px 16px rgba(14, 165, 233, 0.3),
        0 3px 8px rgba(0, 0, 0, 0.15);
    }

    /* Premium Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 24px;
      overflow-y: auto;
      backdrop-filter: blur(8px);
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.98) 0%, rgba(255, 255, 255, 0.95) 100%);
      border: 2px solid rgba(226, 232, 240, 0.8);
      border-radius: 28px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 
        0 24px 80px rgba(0, 0, 0, 0.2),
        0 8px 32px rgba(0, 0, 0, 0.15),
        0 0 0 1px rgba(255, 255, 255, 0.5) inset;
      position: relative;
      animation: slideUpScale 0.4s cubic-bezier(0.16, 1, 0.3, 1);
      backdrop-filter: blur(20px);
    }
    
    @keyframes slideUpScale {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 32px;
      border-bottom: 2px solid rgba(226, 232, 240, 0.6);
      position: sticky;
      top: 0;
      background: linear-gradient(135deg, rgba(14, 165, 233, 0.03), rgba(99, 102, 241, 0.02));
      z-index: 10;
      border-radius: 28px 28px 0 0;
    }

    .modal-title {
      font-size: clamp(1.5rem, 3vw, 2rem);
      font-weight: 800;
      background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin: 0;
      letter-spacing: -0.02em;
    }

    .modal-close {
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid rgba(226, 232, 240, 0.8);
      font-size: 1.5rem;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 0;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.1),
        0 1px 2px rgba(0, 0, 0, 0.05);
      font-weight: 300;
      line-height: 1;
    }

    .modal-close:hover {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
      border-color: rgba(239, 68, 68, 0.4);
      color: #ef4444;
      transform: scale(1.1) rotate(90deg);
      box-shadow: 
        0 4px 12px rgba(239, 68, 68, 0.2),
        0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .modal-body {
      padding: 32px;
    }

    /* Enhanced Timeline - Premium */
    .timeline {
      position: relative;
      padding-left: 40px;
      margin: 32px 0;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 12px;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(180deg, rgba(14, 165, 233, 0.2), rgba(99, 102, 241, 0.2));
      border-radius: 2px;
    }

    .timeline-item {
      position: relative;
      margin-bottom: 32px;
      padding-left: 20px;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -28px;
      top: 6px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: white;
      border: 4px solid rgba(226, 232, 240, 0.8);
      z-index: 2;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.1),
        0 0 0 4px rgba(255, 255, 255, 0.8);
    }

    .timeline-item.completed::before {
      background: linear-gradient(135deg, #10b981, #059669);
      border-color: #10b981;
      box-shadow: 
        0 0 0 6px rgba(16, 185, 129, 0.2),
        0 4px 12px rgba(16, 185, 129, 0.3);
      transform: scale(1.1);
    }

    .timeline-item.active::before {
      background: linear-gradient(135deg, #0ea5e9, #6366f1);
      border-color: #0ea5e9;
      box-shadow: 
        0 0 0 6px rgba(14, 165, 233, 0.2),
        0 4px 12px rgba(14, 165, 233, 0.3);
      animation: pulse-ring 2s ease-out infinite;
      transform: scale(1.1);
    }
    
    @keyframes pulse-ring {
      0% {
        box-shadow: 
          0 0 0 6px rgba(14, 165, 233, 0.2),
          0 4px 12px rgba(14, 165, 233, 0.3);
      }
      50% {
        box-shadow: 
          0 0 0 10px rgba(14, 165, 233, 0.1),
          0 4px 12px rgba(14, 165, 233, 0.3);
      }
      100% {
        box-shadow: 
          0 0 0 6px rgba(14, 165, 233, 0.2),
          0 4px 12px rgba(14, 165, 233, 0.3);
      }
    }

    .timeline-content {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95));
      padding: 20px;
      border-radius: 16px;
      border: 2px solid rgba(226, 232, 240, 0.6);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.05),
        0 1px 2px rgba(0, 0, 0, 0.03);
      position: relative;
      overflow: hidden;
    }
    
    .timeline-content::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(180deg, #0ea5e9, #6366f1);
      transform: scaleY(0);
      transition: transform 0.3s ease;
      transform-origin: top;
    }
    
    .timeline-item.completed .timeline-content::before,
    .timeline-item.active .timeline-content::before {
      transform: scaleY(1);
    }
    
    .timeline-content:hover{
      background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(248, 250, 252, 0.98));
      border-color: rgba(14, 165, 233, 0.3);
      transform: translateY(-4px) translateX(4px);
      box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.1),
        0 4px 8px rgba(0, 0, 0, 0.05);
    }

    .timeline-title {
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-size: 17px;
      letter-spacing: -0.01em;
    }

    .timeline-date {
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    /* Enhanced Info Grid - Premium */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 32px;
    }

    .info-card {
      padding: 20px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95));
      border: 2px solid rgba(226, 232, 240, 0.6);
      border-radius: 16px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.05),
        0 1px 2px rgba(0, 0, 0, 0.03);
      position: relative;
      overflow: hidden;
    }
    
    .info-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #0ea5e9, #6366f1);
      transform: scaleX(0);
      transition: transform 0.3s ease;
      transform-origin: left;
    }
    
    .info-card:hover::before {
      transform: scaleX(1);
    }
    
    .info-card:hover{
      background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(248, 250, 252, 0.98));
      border-color: rgba(14, 165, 233, 0.3);
      transform: translateY(-4px);
      box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.1),
        0 4px 8px rgba(0, 0, 0, 0.05);
    }

    .info-label {
      font-size: 11px;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 8px;
      font-weight: 700;
    }

    .info-value {
      font-size: 18px;
      font-weight: 800;
      color: var(--text-primary);
      letter-spacing: -0.02em;
      line-height: 1.2;
    }

    /* Enhanced Participants - Premium */
    .participants-section {
      margin-top: 32px;
    }
    
    .participants-section h3 {
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 20px;
      letter-spacing: -0.01em;
      background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .participant-card {
      padding: 20px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95));
      border: 2px solid rgba(226, 232, 240, 0.6);
      border-radius: 16px;
      margin-bottom: 16px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.05),
        0 1px 2px rgba(0, 0, 0, 0.03);
      position: relative;
      overflow: hidden;
    }
    
    .participant-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(180deg, #0ea5e9, #6366f1);
      transform: scaleY(0);
      transition: transform 0.3s ease;
      transform-origin: top;
    }
    
    .participant-card:hover::before {
      transform: scaleY(1);
    }
    
    .participant-card:hover{
      background: linear-gradient(135deg, rgba(255, 255, 255, 1), rgba(248, 250, 252, 0.98));
      border-color: rgba(14, 165, 233, 0.3);
      transform: translateY(-4px) translateX(4px);
      box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.1),
        0 4px 8px rgba(0, 0, 0, 0.05);
    }

    .participant-name {
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-size: 17px;
      letter-spacing: -0.01em;
    }

    .participant-detail {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 6px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Enhanced Invoice Link */
    .invoice-link {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-4);
      background: var(--gradient-subtle);
      color: var(--accent-primary);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-lg);
      text-decoration: none;
      font-weight: 700;
      transition: all 0.2s ease;
      backdrop-filter: blur(5px);
    }

    .invoice-link:hover {
      background: var(--gradient-primary);
      color: white;
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    /* Enhanced Auth Required */
    .auth-required-container {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
      padding: var(--space-8);
    }

    .auth-required-content {
      text-align: center;
      max-width: 400px;
      background: var(--card-primary);
      border: 1px solid var(--border-default);
      border-radius: var(--radius-3xl);
      padding: var(--space-8);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow-xl);
    }

    .auth-required-icon {
      font-size: 4rem;
      margin-bottom: var(--space-6);
      filter: drop-shadow(0 0 20px rgba(0, 102, 255, 0.3));
    }

    .auth-required-title {
      font-size: 1.75rem;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: var(--space-4);
      letter-spacing: -0.02em;
    }

    .auth-required-message {
      color: var(--text-tertiary);
      margin-bottom: var(--space-8);
      font-size: 16px;
      line-height: 1.6;
    }

    /* Enhanced Responsive - Tourism Mobile First */
    @media (max-width: 768px) {
      .reservations-container {
        padding: var(--space-20) var(--space-4);
      }

      .section-header h1 {
        font-size: clamp(28px, 6vw, 36px);
      }

      .section-subtitle {
        font-size: 16px;
      }

      .reservation-header {
        flex-direction: column;
        gap: var(--space-3);
        padding: var(--space-6) var(--space-6) var(--space-4);
      }

      .reservation-title {
        font-size: 1.25rem;
      }
      
      .reservation-id {
        font-size: 12px;
        padding: var(--space-1) var(--space-2);
      }

      .reservation-status-badge {
        padding: var(--space-2) var(--space-4);
        font-size: 11px;
      }

      .reservation-body {
        padding: var(--space-4) var(--space-6);
      }

      .reservation-details-grid {
        grid-template-columns: 1fr;
        gap: var(--space-3);
      }

      .detail-label {
        font-size: 10px;
      }

      .detail-value {
        font-size: 14px;
      }

      .reservation-actions {
        padding: var(--space-4) var(--space-6) var(--space-6);
        flex-direction: column;
        gap: var(--space-3);
      }

      .btn-action {
        width: 100%;
        justify-content: center;
        min-width: auto;
      }

      .modal {
        padding: var(--space-4);
      }

      .modal-content {
        margin: var(--space-4);
        border-radius: var(--radius-2xl);
      }

      .modal-header {
        padding: var(--space-6);
      }

      .modal-title {
        font-size: 1.5rem;
      }

      .modal-body {
        padding: var(--space-6);
      }
    }

    @media (max-width: 480px) {
      .reservations-container {
        padding: var(--space-16) var(--space-3);
      }

      .section-header h1 {
        font-size: clamp(24px, 8vw, 32px);
      }

      .section-subtitle {
        font-size: 15px;
      }

      .reservation-card {
        border-radius: var(--radius-2xl);
      }

      .reservation-header {
        padding: var(--space-4) var(--space-4) var(--space-3);
      }

      .reservation-title {
        font-size: 1.125rem;
      }
      
      .reservation-id {
        font-size: 11px;
        padding: var(--space-1) var(--space-2);
      }

      .reservation-status-badge {
        padding: var(--space-2) var(--space-3);
        font-size: 10px;
      }

      .reservation-body {
        padding: var(--space-3) var(--space-4);
      }

      .reservation-details-grid {
        gap: var(--space-2);
      }

      .detail-label {
        font-size: 9px;
      }

      .detail-value {
        font-size: 13px;
      }

      .reservation-actions {
        padding: var(--space-3) var(--space-4) var(--space-4);
        gap: var(--space-2);
      }

      .btn-action {
        padding: var(--space-3) var(--space-4);
        font-size: 13px;
      }

      .modal-content {
        margin: var(--space-3);
        border-radius: var(--radius-xl);
      }

      .modal-header {
        padding: var(--space-4);
      }

      .modal-title {
        font-size: 1.25rem;
      }

      .modal-body {
        padding: var(--space-4);
      }

      .empty-state-container,
      .error-state {
        padding: var(--space-24) var(--space-4);
        margin: 0 auto;
      }
    }

    /* Loading spinner enhancement */
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-subtle);
      border-top: 3px solid var(--accent-primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="nav-inner wrap">
      <div class="brand">
        <div class="mark"></div>
        <a href="/"><span class="brand-text">ToursPanama</span></a>
      </div>
      <div class="nav-links">
        <a href="/" class="nav-link">Tours</a>
        <a href="/reservas.html" class="nav-link active">Mis Reservas</a>
        <span class="nav-user-greeting" id="userGreeting" style="display:none;"></span>
        <a href="/login.html" class="nav-link" id="loginLink">Iniciar Sesi√≥n</a>
        <a href="/profile.html" class="nav-link" id="profileLink" style="display:none;">Mi Perfil</a>
        <button class="btn-primary" id="logoutBtn" style="display:none;">Cerrar Sesi√≥n</button>
      </div>
    </div>
  </nav>

  <main class="reservations-container">
    <div class="section-header">
      <h1>Mis Reservas</h1>
      <p class="section-subtitle">Gestiona tus reservas de tours</p>
    </div>

    <!-- Mensaje cuando no est√° autenticado -->
    <div id="authRequired" class="auth-required-container" style="display:none;">
      <div class="auth-required-content">
        <div class="auth-required-icon">üîí</div>
        <h2 class="auth-required-title">Inicia Sesi√≥n para Ver tus Reservas</h2>
        <p class="auth-required-message">
          Necesitas iniciar sesi√≥n para acceder a tus reservas y gestionar tus tours.
        </p>
        <a href="/login.html?redirect=/reservas.html" class="btn-primary">Iniciar Sesi√≥n</a>
      </div>
    </div>

    <!-- Contenido cuando est√° autenticado -->
    <div id="authenticatedContent" style="display:none;">
      <!-- Loading State -->
      <div id="loadingState" class="loading-container" style="display:none;">
        <div class="spinner"></div>
        <p>Cargando tus reservas...</p>
      </div>

      <!-- Error State -->
      <div id="errorState" class="error-state" style="display:none;">
        <div class="error-state-icon">‚ö†Ô∏è</div>
        <h2 class="empty-state-title">Error al cargar reservas</h2>
        <p class="empty-state-message">
          No pudimos cargar tus reservas. Por favor, intenta nuevamente.
        </p>
        <button class="btn-primary" onclick="loadReservations()">Reintentar</button>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="empty-state-container" style="display:none;">
        <div class="empty-state-icon">üìã</div>
        <h2 class="empty-state-title">No tienes reservas a√∫n</h2>
        <p class="empty-state-message">
          Explora nuestros tours y reserva tu pr√≥xima aventura en Panam√°.
        </p>
        <a href="/" class="btn-primary">Explorar Tours</a>
      </div>

      <!-- Reservations List -->
      <div id="reservationsList" class="reservations-list"></div>
    </div>

    <!-- Modal de Detalle de Reserva -->
    <div id="bookingModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" id="modalBookingTitle">Detalle de Reserva</h2>
          <button class="modal-close" onclick="closeBookingModal()" aria-label="Cerrar">&times;</button>
        </div>
        <div class="modal-body" id="modalBookingContent">
          <div class="loading-container">
            <div class="spinner"></div>
            <p>Cargando detalles...</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="/js/loading.js"></script>
  <script src="/js/logger.js"></script>
  <script src="/js/api.js"></script>
  <script src="/js/notifications.js"></script>
  <script>
    let allReservations = [];
    let allInvoices = [];

    // Helper para obtener valores (manejar PascalCase y camelCase)
    const getValue = (obj, pascalKey, camelKey, defaultValue = null) => {
      return obj[pascalKey] ?? obj[camelKey] ?? defaultValue;
    };

    // Formatear precio
    function formatPrice(value, currency = 'USD') {
      const price = Number(value ?? 0);
      const currencySymbol = currency === 'USD' ? '$' : currency;
      return price > 0 ? `${currencySymbol}${price.toFixed(2)}` : `${currencySymbol}0.00`;
    }

    // Formatear fecha
    function formatDate(dateStr, includeTime = false) {
      if (!dateStr) return 'Por definir';
      try {
        const date = new Date(dateStr);
        const options = {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        };
        if (includeTime) {
          options.hour = '2-digit';
          options.minute = '2-digit';
        }
        return date.toLocaleDateString('es-PA', options);
      } catch (e) {
        return dateStr;
      }
    }

    // Verificar autenticaci√≥n
    function checkAuth() {
      const token = localStorage.getItem('authToken') || localStorage.getItem('accessToken');
      const loginLink = document.getElementById('loginLink');
      const logoutBtn = document.getElementById('logoutBtn');
      const profileLink = document.getElementById('profileLink');
      const authRequired = document.getElementById('authRequired');
      const authenticatedContent = document.getElementById('authenticatedContent');
      const userGreeting = document.getElementById('userGreeting');

      if (!token) {
        authRequired.style.display = 'flex';
        authenticatedContent.style.display = 'none';
        if (loginLink) loginLink.style.display = 'block';
        if (logoutBtn) logoutBtn.style.display = 'none';
        if (profileLink) profileLink.style.display = 'none';
        if (userGreeting) userGreeting.style.display = 'none';
        return false;
      }

      // Verificar si es admin
      const userRoles = JSON.parse(localStorage.getItem('userRoles') || '[]');
      const isAdmin = Array.isArray(userRoles) && (
        userRoles.some(role => role && role.toLowerCase() === 'admin')
      );

      if (isAdmin) {
        window.location.href = '/admin.html';
        return false;
      }

      // Autenticado y NO es admin
      authRequired.style.display = 'none';
      authenticatedContent.style.display = 'block';
      if (loginLink) loginLink.style.display = 'none';
      if (logoutBtn) logoutBtn.style.display = 'block';
      if (profileLink) profileLink.style.display = 'block';
      loadUserInfo();
      return true;
    }

    // Cargar informaci√≥n del usuario
    async function loadUserInfo() {
      const token = localStorage.getItem('authToken') || localStorage.getItem('accessToken');
      const userGreeting = document.getElementById('userGreeting');
      
      if (!token || !userGreeting) return;

      try {
        let userName = localStorage.getItem('userName');
        if (!userName) {
          const currentUser = await api.getCurrentUser();
          const firstName = getValue(currentUser, 'FirstName', 'firstName', '');
          const lastName = getValue(currentUser, 'LastName', 'lastName', '');
          userName = `${firstName} ${lastName}`.trim();
          if (userName) localStorage.setItem('userName', userName);
        }
        if (userName) {
          userGreeting.textContent = `Hola, ${userName}`;
          userGreeting.style.display = 'inline-flex';
        }
      } catch (error) {
        console.warn('Error loading user info:', error);
      }
    }

    // Cargar reservas
    async function loadReservations() {
      if (!checkAuth()) return;

      const loadingState = document.getElementById('loadingState');
      const emptyState = document.getElementById('emptyState');
      const errorState = document.getElementById('errorState');
      const reservationsList = document.getElementById('reservationsList');

      try {
        loadingState.style.display = 'flex';
        emptyState.style.display = 'none';
        errorState.style.display = 'none';
        reservationsList.innerHTML = '';

        // Cargar reservas e facturas en paralelo
        const [reservations, invoices] = await Promise.all([
          api.getMyBookings().catch(() => []),
          api.getMyInvoices().catch(() => [])
        ]);

        allReservations = reservations || [];
        allInvoices = invoices || [];

        loadingState.style.display = 'none';

        if (allReservations.length === 0) {
          emptyState.style.display = 'block';
          return;
        }

        renderReservations();
      } catch (error) {
        console.error('Error loading reservations:', error);
        loadingState.style.display = 'none';
        const errorMsg = error.message && error.message.includes('401')
          ? 'Tu sesi√≥n expir√≥. Por favor, inicia sesi√≥n nuevamente.'
          : error.message && (error.message.includes('network') || error.message.includes('fetch'))
          ? 'Algo sali√≥ mal. Int√©ntalo de nuevo en unos segundos.'
          : 'Error al cargar reservas. Por favor intenta de nuevo.';
        const errorStateTitle = document.querySelector('#errorState .empty-state-title');
        const errorStateMessage = document.querySelector('#errorState .empty-state-message');
        if (errorStateTitle) errorStateTitle.textContent = 'Error al cargar reservas';
        if (errorStateMessage) errorStateMessage.textContent = errorMsg;
        errorState.style.display = 'block';
      }
    }

    // Renderizar reservas
    function renderReservations() {
      const reservationsList = document.getElementById('reservationsList');
      const emptyState = document.getElementById('emptyState');

      if (allReservations.length === 0) {
        emptyState.style.display = 'block';
        reservationsList.innerHTML = '';
        return;
      }

      emptyState.style.display = 'none';
      reservationsList.innerHTML = allReservations.map(res => createReservationCard(res)).join('');
    }

    // Crear card de reserva - Tourism Premium Design
    function createReservationCard(reservation) {
      const status = getValue(reservation, 'Status', 'status', 'Pending');
      const tourName = getValue(reservation, 'TourName', 'tourName', 'Tour sin nombre');
      const reservationId = getValue(reservation, 'Id', 'id', '');
      const createdAt = getValue(reservation, 'CreatedAt', 'createdAt');
      const numberOfParticipants = getValue(reservation, 'NumberOfParticipants', 'numberOfParticipants', 0);
      const totalAmount = getValue(reservation, 'TotalAmount', 'totalAmount', 0);
      const tourDate = getValue(reservation, 'TourDate', 'tourDate');
      const currency = getValue(reservation, 'Currency', 'currency', 'USD');

      const statusLower = (status || '').toLowerCase();
      const statusClass = `status-${statusLower}`;
      
      const statusText = {
        'pending': 'Pendiente',
        'confirmed': 'Confirmada',
        'cancelled': 'Cancelada',
        'expired': 'Expirada',
        'completed': 'Completada'
      }[statusLower] || status || 'Desconocido';

      // CTA seg√∫n estado - Tourism Focused
      let primaryButton = '';
      let secondaryButton = '';
      
      if (statusLower === 'pending') {
        const tourId = getValue(reservation, 'TourId', 'tourId', '');
        primaryButton = `<button class="btn-action btn-action-primary" onclick="event.stopPropagation(); goToPay('${reservationId}')">Completar reserva</button>`;
        secondaryButton = `<button class="btn-action btn-action-secondary" onclick="viewBookingDetail('${reservationId}')">Ver Detalles</button>`;
      } else if (statusLower === 'confirmed') {
        primaryButton = `<button class="btn-action btn-action-primary" onclick="viewBookingDetail('${reservationId}')">Ver Detalles</button>`;
        secondaryButton = `<button class="btn-action btn-action-secondary" onclick="event.stopPropagation(); viewBookingDetail('${reservationId}')">M√°s Info</button>`;
      } else if (statusLower === 'completed') {
        primaryButton = `<button class="btn-action btn-action-primary" onclick="leaveReview('${reservationId}')">Dejar Rese√±a</button>`;
        secondaryButton = `<button class="btn-action btn-action-secondary" onclick="viewBookingDetail('${reservationId}')">Ver Detalles</button>`;
      } else if (statusLower === 'cancelled') {
        primaryButton = `<button class="btn-action btn-action-primary" onclick="contactSupport()">Contactar Soporte</button>`;
        secondaryButton = `<button class="btn-action btn-action-secondary" onclick="viewBookingDetail('${reservationId}')">Ver Detalles</button>`;
      } else {
        primaryButton = `<button class="btn-action btn-action-primary" onclick="viewBookingDetail('${reservationId}')">Ver Detalles</button>`;
        secondaryButton = '';
      }

      // Buscar factura asociada
      const invoice = allInvoices.find(inv => 
        getValue(inv, 'BookingId', 'bookingId') === reservationId
      );
      const invoiceLink = invoice 
        ? `<a href="/profile.html" class="invoice-link" onclick="event.stopPropagation();">üìÑ Ver factura</a>`
        : '';

      return `
        <div class="reservation-card" onclick="viewBookingDetail('${reservationId}')">
          <!-- Card Header: Tour Name & Status -->
          <div class="reservation-header">
            <div class="reservation-title-section">
              <h3 class="reservation-title">${tourName}</h3>
              <p class="reservation-id">Reserva #${reservationId.substring(0, 8).toUpperCase()}</p>
            </div>
            <span class="reservation-status-badge ${statusClass}">${statusText}</span>
          </div>
          
          <!-- Card Body: Key Information -->
          <div class="reservation-body">
            <div class="reservation-details-grid">
              <div class="detail-item">
                <span class="detail-label">Fecha del Tour</span>
                <span class="detail-value">${formatDate(tourDate)}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Participantes</span>
                <span class="detail-value">${numberOfParticipants}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Total</span>
                <span class="detail-value">${formatPrice(totalAmount, currency)}</span>
              </div>
              <div class="detail-item">
                <span class="detail-label">Reservado</span>
                <span class="detail-value">${formatDate(createdAt)}</span>
              </div>
            </div>
          </div>
          
          <!-- Card Footer: Actions -->
          <div class="reservation-actions" onclick="event.stopPropagation();">
            ${primaryButton}
            ${secondaryButton}
            ${invoiceLink}
          </div>
        </div>
      `;
    }

    // Ver detalle de reserva
    async function viewBookingDetail(bookingId) {
      const modal = document.getElementById('bookingModal');
      const modalContent = document.getElementById('modalBookingContent');
      const modalTitle = document.getElementById('modalBookingTitle');
      
      modal.classList.add('active');
      modalContent.innerHTML = '<div class="loading-container"><div class="spinner"></div><p>Cargando detalles...</p></div>';
      
      try {
        const booking = await api.getBooking(bookingId);
        
        const status = getValue(booking, 'Status', 'status', 'Pending');
        const tourName = getValue(booking, 'TourName', 'tourName', 'Tour sin nombre');
        const numberOfParticipants = getValue(booking, 'NumberOfParticipants', 'numberOfParticipants', 0);
        const totalAmount = getValue(booking, 'TotalAmount', 'totalAmount', 0);
        const tourDate = getValue(booking, 'TourDate', 'tourDate');
        const createdAt = getValue(booking, 'CreatedAt', 'createdAt');
        const participants = getValue(booking, 'Participants', 'participants', []);
        const currency = getValue(booking, 'Currency', 'currency', 'USD');
        const payments = getValue(booking, 'Payments', 'payments', []);

        const statusLower = (status || '').toLowerCase();
        const statusText = {
          'pending': 'Pendiente',
          'confirmed': 'Confirmada',
          'cancelled': 'Cancelada',
          'expired': 'Expirada',
          'completed': 'Completada'
        }[statusLower] || status || 'Desconocido';

        // Buscar factura
        const invoice = allInvoices.find(inv => 
          getValue(inv, 'BookingId', 'bookingId') === bookingId
        );

        // Timeline de estados
        const timelineItems = [
          {
            title: 'Reserva Creada',
            date: formatDate(createdAt, true),
            completed: true,
            active: false
          },
          {
            title: 'Pago Realizado',
            date: payments.length > 0 ? formatDate(payments[0].CreatedAt || payments[0].createdAt, true) : 'Pendiente',
            completed: statusLower !== 'pending',
            active: statusLower === 'pending'
          },
          {
            title: 'Reserva Confirmada',
            date: statusLower === 'confirmed' || statusLower === 'completed' ? formatDate(createdAt, true) : 'Pendiente',
            completed: statusLower === 'confirmed' || statusLower === 'completed',
            active: statusLower === 'confirmed'
          },
          {
            title: 'Tour Completado',
            date: statusLower === 'completed' ? formatDate(tourDate, true) : 'Pendiente',
            completed: statusLower === 'completed',
            active: false
          }
        ];

        modalTitle.textContent = `Reserva: ${tourName}`;
        
        modalContent.innerHTML = `
          <div class="info-grid">
            <div class="info-card">
              <div class="info-label">Estado</div>
              <div class="info-value">
                <span class="reservation-status-badge status-${statusLower}">${statusText}</span>
              </div>
            </div>
            <div class="info-card">
              <div class="info-label">Fecha del Tour</div>
              <div class="info-value">${formatDate(tourDate)}</div>
            </div>
            <div class="info-card">
              <div class="info-label">Participantes</div>
              <div class="info-value">${numberOfParticipants}</div>
            </div>
            <div class="info-card">
              <div class="info-label">Total</div>
              <div class="info-value">${formatPrice(totalAmount, currency)}</div>
            </div>
            <div class="info-card">
              <div class="info-label">Fecha de Reserva</div>
              <div class="info-value">${formatDate(createdAt, true)}</div>
            </div>
            ${invoice ? `
            <div class="info-card">
              <div class="info-label">Factura</div>
              <div class="info-value">
                <a href="/profile.html" class="invoice-link">üìÑ Ver factura</a>
              </div>
            </div>
            ` : ''}
          </div>

          <div class="timeline">
            ${timelineItems.map((item, index) => `
              <div class="timeline-item ${item.completed ? 'completed' : ''} ${item.active ? 'active' : ''}">
                <div class="timeline-content">
                  <div class="timeline-title">${item.title}</div>
                  <div class="timeline-date">${item.date}</div>
                </div>
              </div>
            `).join('')}
          </div>

          ${participants && participants.length > 0 ? `
            <div class="participants-section">
              <h3 style="margin-bottom: var(--space-md);">Participantes</h3>
              ${participants.map(p => {
                const firstName = getValue(p, 'FirstName', 'firstName', '');
                const lastName = getValue(p, 'LastName', 'lastName', '');
                const email = getValue(p, 'Email', 'email', '');
                const phone = getValue(p, 'Phone', 'phone', '');
                return `
                  <div class="participant-card">
                    <div class="participant-name">${firstName} ${lastName}</div>
                    ${email ? `<div class="participant-detail">üìß ${email}</div>` : ''}
                    ${phone ? `<div class="participant-detail">üì± ${phone}</div>` : ''}
                  </div>
                `;
              }).join('')}
            </div>
          ` : ''}

          ${payments && payments.length > 0 ? `
            <div style="margin-top: var(--space-xl);">
              <h3 style="margin-bottom: var(--space-md);">Pagos</h3>
              <div class="info-grid">
                ${payments.map(p => {
                  const amount = getValue(p, 'Amount', 'amount', 0);
                  const status = getValue(p, 'Status', 'status', '');
                  const createdAt = getValue(p, 'CreatedAt', 'createdAt');
                  return `
                    <div class="info-card">
                      <div class="info-label">Pago</div>
                      <div class="info-value">${formatPrice(amount, currency)}</div>
                      <div class="info-label" style="margin-top: var(--space-xs);">${formatDate(createdAt, true)}</div>
                      <div class="info-value" style="font-size: var(--text-xs);">${status}</div>
                    </div>
                  `;
                }).join('')}
              </div>
            </div>
          ` : ''}

          <div style="margin-top: var(--space-xl); padding-top: var(--space-lg); border-top: 2px solid var(--border);">
            <button class="btn-action btn-action-secondary" onclick="closeBookingModal()">Cerrar</button>
          </div>
        `;
      } catch (error) {
        console.error('Error loading booking details:', error);
        modalContent.innerHTML = `
          <div class="error-state">
            <div class="error-state-icon">‚ö†Ô∏è</div>
            <h2 class="empty-state-title">Error al cargar detalles</h2>
            <p class="empty-state-message">No pudimos cargar los detalles de esta reserva.</p>
            <button class="btn-primary" onclick="viewBookingDetail('${bookingId}')">Reintentar</button>
          </div>
        `;
      }
    }

    // Cerrar modal
    function closeBookingModal() {
      document.getElementById('bookingModal').classList.remove('active');
    }

    // Cerrar modal al hacer clic fuera
    document.getElementById('bookingModal').addEventListener('click', (e) => {
      if (e.target.id === 'bookingModal') {
        closeBookingModal();
      }
    });

    // Acciones
    function goToPay(bookingId) {
      if (!bookingId) return;
      window.location.href = `/checkout.html?bookingId=${bookingId}`;
    }

    function leaveReview(bookingId) {
      // TODO: Implementar p√°gina de rese√±as
      alert('Pr√≥ximamente: podr√°s dejar una rese√±a sobre este tour.');
    }

    function contactSupport() {
      // TODO: Implementar contacto de soporte
      alert('Para contactar soporte, env√≠a un email a soporte@panamatravelhub.com');
    }

    // Logout
    if (document.getElementById('logoutBtn')) {
      document.getElementById('logoutBtn').addEventListener('click', async () => {
        await api.logout();
        window.location.href = '/';
      });
    }

    // Inicializar
    document.addEventListener('DOMContentLoaded', () => {
      if (checkAuth()) {
        loadReservations();
      }
    });
  </script>
</body>
</html>
